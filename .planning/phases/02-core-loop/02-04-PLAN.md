---
phase: 02-core-loop
plan: 04
type: execute
wave: 4
depends_on: ["02-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User sends message, Claude reads conversation context"
    - "Claude retrieves past messages when asked about history"
    - "Conversation file contains timestamped user/assistant exchanges"
    - "Identity files influence Claude's response style"
  artifacts: []
  key_links: []
---

<objective>
End-to-end verification of the core loop: message -> memory -> Claude -> response.

Purpose: Validate the complete flow before marking Phase 2 complete.
Output: Verified working system with conversation memory.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-loop/02-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 2 implementation:
- ~/.klausbot/ data home with config/, conversations/, identity/ directories
- Identity files (SOUL.md, IDENTITY.md, USER.md) with sensible defaults
- Conversation logging to daily markdown files
- Context injection via --append-system-prompt
- Spawner with cwd=~/.klausbot/ for agentic file access
- CLI 'init' and 'gateway' subcommands
  </what-built>
  <how-to-verify>
## Setup (if not already running)

1. Build and start gateway:
```bash
cd /Users/soham/Documents/GitHub/clawdbot
npm run build
node dist/index.js gateway
```

## Test Cases

### Test 1: Basic Message Logging
1. Send a simple message to the bot: "Hello, this is a test message"
2. Check conversation file exists:
```bash
cat ~/.klausbot/conversations/$(date +%Y-%m-%d).md
```
3. Verify file contains timestamped User/Assistant exchange

### Test 2: Context Awareness
1. Send: "My name is [your name]"
2. In a new message, ask: "What is my name?"
3. Claude should retrieve from conversation context

### Test 3: Memory Retrieval
1. Send: "Remember that I prefer concise answers"
2. Later, ask: "What do you know about my preferences?"
3. Claude should reference the stated preference (either from conversation or USER.md)

### Test 4: Identity Influence
1. Check Claude's response style matches IDENTITY.md (concise, direct)
2. Ask: "What's your name?"
3. Should respond as "Klaus" per identity files

### Test 5: Important Markers
1. Send: "[!important] Test important marker"
2. Later, ask: "What important things have I told you?"
3. Claude should use grep to find [!important] markers

## Verification Checklist

- [ ] ~/.klausbot/config/ directory exists
- [ ] ~/.klausbot/conversations/ contains today's date file
- [ ] ~/.klausbot/identity/ contains SOUL.md, IDENTITY.md, USER.md
- [ ] Conversation file has readable markdown format
- [ ] Claude responds with awareness of conversation context
- [ ] Claude identifies as "Klaus" (from identity files)
  </how-to-verify>
  <resume-signal>Type "verified" if all tests pass, or describe issues encountered</resume-signal>
</task>

</tasks>

<verification>
Human verification checkpoint - success determined by manual testing.
</verification>

<success_criteria>
Phase 2 success criteria from ROADMAP.md:
1. User asks "what did we discuss yesterday?" and Claude retrieves relevant conversation via agentic file reading
2. All conversations persisted to storage (queryable later)
3. Claude's response reflects context from identity files (SOUL.md, IDENTITY.md, USER.md)
4. User preferences stated in conversation appear in USER.md within same session
5. Semantic search returns relevant memories when queried about past topics

Note: Items 4 (USER.md update) and 5 (semantic search) may require Claude's discretion - if Claude doesn't proactively update USER.md, that's acceptable for Phase 2 (enhancement for Phase 3).
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-loop/02-04-SUMMARY.md`
</output>

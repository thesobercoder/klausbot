---
phase: 01-foundation
plan: 06
type: execute
wave: 5
depends_on: ["01-05"]
files_modified:
  - src/cli/install.ts
  - src/cli/index.ts
  - src/index.ts
  - klausbot.service
  - Dockerfile
autonomous: true

must_haves:
  truths:
    - "klausbot install wizard configures deployment"
    - "systemd service file generated and installable"
    - "Dockerfile builds and runs correctly"
    - "Dev mode runs without installation"
  artifacts:
    - path: "src/cli/install.ts"
      provides: "Interactive installation wizard"
      exports: ["runInstallWizard"]
    - path: "klausbot.service"
      provides: "systemd service template"
    - path: "Dockerfile"
      provides: "Container build definition"
  key_links:
    - from: "src/cli/install.ts"
      to: "@inquirer/prompts"
      via: "interactive prompts"
      pattern: "input|select|confirm"
---

<objective>
Add deployment tooling: interactive install wizard, systemd service, and Docker support.

Purpose: Make klausbot easy to deploy - wizard guides setup, systemd/Docker for production.
Output: Working install command, systemd service, Dockerfile.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create install wizard</name>
  <files>src/cli/install.ts, src/cli/index.ts</files>
  <action>
Create src/cli/install.ts following RESEARCH.md CLI wizard pattern:

Import:

- input, confirm, select from @inquirer/prompts
- execSync from child_process
- writeFileSync, existsSync from fs
- logger from ../utils

Export async function runInstallWizard(): Promise<void>

1. Welcome message:

   ```
   Klausbot Installation Wizard

   This wizard will help you configure klausbot for your environment.
   ```

2. Check prerequisites:
   - Claude CLI installed: execSync('claude --version', { stdio: 'pipe' })
   - If missing, warn and ask to continue anyway

3. Prompt for TELEGRAM_BOT_TOKEN:
   - input({ message: 'Telegram Bot Token:', validate: includes(':') })
   - Explain: "Get this from @BotFather on Telegram"

4. Prompt for deployment mode:
   - select with options:
     - 'systemd' (recommended for Linux servers)
     - 'docker' (containerized deployment)
     - 'dev' (development, run foreground)

5. If systemd:
   - Check systemctl available
   - If not, fallback to docker or dev
   - Prompt for install location (default /opt/klausbot)
   - Prompt for data directory (default /opt/klausbot/data)
   - Generate .env file
   - Generate klausbot.service from template
   - Ask to install now:
     - Copy service file to /etc/systemd/system/
     - systemctl daemon-reload
     - systemctl enable klausbot
     - systemctl start klausbot
   - Print status and next steps

6. If docker:
   - Check docker available
   - Generate .env file
   - Print docker run command:
     ```
     docker build -t klausbot .
     docker run -d --name klausbot --env-file .env -v ./data:/app/data klausbot
     ```

7. If dev:
   - Generate .env file
   - Print: "Run: npm run dev"

Create src/cli/index.ts:

- Export runInstallWizard from ./install
  </action>
  <verify>Run wizard, complete all prompts, verify .env created correctly</verify>
  <done>Install wizard guides through setup for all deployment modes</done>
  </task>

<task type="auto">
  <name>Task 2: Create systemd service and Dockerfile</name>
  <files>klausbot.service, Dockerfile, .dockerignore</files>
  <action>
Create klausbot.service following RESEARCH.md systemd pattern:

```ini
[Unit]
Description=Klausbot Telegram Gateway
Documentation=https://github.com/yourrepo/klausbot
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=klausbot
Group=klausbot
WorkingDirectory=/opt/klausbot
ExecStart=/usr/bin/node /opt/klausbot/dist/index.js daemon
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
EnvironmentFile=/opt/klausbot/.env

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/opt/klausbot/data

[Install]
WantedBy=multi-user.target
```

Create Dockerfile:

```dockerfile
FROM node:20-slim

# Install Claude CLI (adjust based on actual installation method)
# This is a placeholder - actual installation TBD in Phase 2
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci --only=production

# Copy built application
COPY dist ./dist

# Create data directory
RUN mkdir -p /app/data

# Environment
ENV NODE_ENV=production
ENV DATA_DIR=/app/data

# Run as non-root
RUN useradd -r -s /bin/false klausbot && chown -R klausbot:klausbot /app
USER klausbot

CMD ["node", "dist/index.js", "daemon"]
```

Create .dockerignore:

```
node_modules
src
*.md
.git
.env
data
```

  </action>
  <verify>docker build -t klausbot . succeeds (may fail on Claude CLI - that's ok for MVP)</verify>
  <done>systemd service template ready, Dockerfile builds Node.js app</done>
</task>

<task type="auto">
  <name>Task 3: Wire install command into CLI</name>
  <files>src/index.ts</files>
  <action>
Update src/index.ts to add 'install' subcommand:

If 'install':

- Import runInstallWizard from ./cli
- Call await runInstallWizard()
- Exit

Update help text to include:

```
klausbot install               Interactive installation wizard
```

Also add version command:

- Read version from package.json
- Print: "klausbot v{version}"

Full updated help:

```
klausbot - Telegram gateway for Claude Code

Usage:
  klausbot [daemon]              Start the gateway daemon
  klausbot install               Interactive installation wizard
  klausbot pairing approve <code>   Approve pairing request
  klausbot pairing reject <code>    Reject pairing request
  klausbot pairing list             List pending/approved users
  klausbot pairing revoke <chatId>  Revoke user access
  klausbot version               Show version
  klausbot help                  Show this help

Environment:
  TELEGRAM_BOT_TOKEN    Telegram bot token (required)
  LOG_LEVEL    Logging level (default: info)
  DATA_DIR     Data directory (default: ./data)
```

  </action>
  <verify>node dist/index.js install runs wizard; node dist/index.js version shows version</verify>
  <done>CLI supports install wizard, version command, comprehensive help</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run build` succeeds
2. `node dist/index.js help` shows all commands including install
3. `node dist/index.js version` shows version from package.json
4. `node dist/index.js install` runs wizard:
   - Prompts for token
   - Offers deployment modes
   - Generates .env file
5. `docker build -t klausbot .` succeeds
6. systemd service file is valid (systemd-analyze verify klausbot.service on Linux)
</verification>

<success_criteria>

- Install wizard runs interactively
- .env file generated correctly from wizard
- systemd service template ready for installation
- Dockerfile builds successfully
- All CLI commands documented in help
- Version command works
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-06-SUMMARY.md`
</output>

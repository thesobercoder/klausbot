---
phase: 02-core-loop
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/memory/home.ts
  - src/memory/identity.ts
  - src/memory/logger.ts
  - src/memory/index.ts
autonomous: true

must_haves:
  truths:
    - "~/.klausbot/ directory structure exists on first run"
    - "Identity files created with sensible defaults when missing"
    - "Conversation exchanges logged to daily markdown file"
  artifacts:
    - path: "src/memory/home.ts"
      provides: "KLAUSBOT_HOME constant, directory initialization"
      exports: ["KLAUSBOT_HOME", "initializeHome", "getHomePath"]
    - path: "src/memory/identity.ts"
      provides: "Identity file initialization"
      exports:
        [
          "initializeIdentity",
          "DEFAULT_SOUL",
          "DEFAULT_IDENTITY",
          "DEFAULT_USER",
        ]
    - path: "src/memory/logger.ts"
      provides: "Conversation logging to daily markdown"
      exports: ["logUserMessage", "logAssistantMessage"]
    - path: "src/memory/index.ts"
      provides: "Module re-exports"
      exports: ["*"]
  key_links:
    - from: "src/memory/home.ts"
      to: "os.homedir()"
      via: "path.join"
      pattern: "join.*homedir.*\\.klausbot"
    - from: "src/memory/logger.ts"
      to: "src/memory/home.ts"
      via: "import KLAUSBOT_HOME"
      pattern: "import.*KLAUSBOT_HOME"
---

<objective>
Create the memory foundation: ~/.klausbot/ data home, identity file initialization, and conversation logging.

Purpose: Establish file-based memory infrastructure that Claude will read/write agentically.
Output: src/memory/ module with home.ts, identity.ts, logger.ts
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-loop/02-CONTEXT.md
@.planning/phases/02-core-loop/02-RESEARCH.md
@src/daemon/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Data home and identity initialization</name>
  <files>src/memory/home.ts, src/memory/identity.ts</files>
  <action>
Create src/memory/home.ts:
- Export KLAUSBOT_HOME = join(homedir(), '.klausbot')
- Export DIRS = ['config', 'conversations', 'identity']
- Export initializeHome(logger: Logger): void - creates all directories if missing
- Export getHomePath(...segments: string[]): string - join helper

Create src/memory/identity.ts:

- Export DEFAULT_SOUL, DEFAULT_IDENTITY, DEFAULT_USER constants (from RESEARCH.md Pattern 3)
- Export initializeIdentity(logger: Logger): void - writes defaults if files missing
- Use getHomePath('identity', filename) for paths
- Log info when creating files, skip silently if exist

Content for defaults (keep concise, under 1KB each):

- SOUL.md: Core values (helpful, remembers context, respects preferences, direct communication)
- IDENTITY.md: Name "Klaus", concise but thorough style
- USER.md: Sections for Preferences, Context, Notes with placeholder text
  </action>
  <verify>

```bash
# Build passes
cd /Users/soham/Documents/GitHub/clawdbot && npm run build

# Files export expected symbols
grep -l "KLAUSBOT_HOME" dist/memory/home.js
grep -l "initializeIdentity" dist/memory/identity.js
```

  </verify>
  <done>home.ts exports KLAUSBOT_HOME + initializeHome; identity.ts exports initializeIdentity + default constants</done>
</task>

<task type="auto">
  <name>Task 2: Conversation logger module</name>
  <files>src/memory/logger.ts, src/memory/index.ts</files>
  <action>
Create src/memory/logger.ts:
- Import KLAUSBOT_HOME, getHomePath from ./home.js
- Use local date for filename: new Date().toLocaleDateString('en-CA') returns YYYY-MM-DD
- Use local time for timestamp: new Date().toLocaleTimeString('en-GB') returns HH:MM:SS
- getConversationPath(): string - returns path to today's conversation file
- ensureConversationFile(): string - creates conversations dir + file with header if missing
- logUserMessage(content: string): void - appends ## HH:MM:SS + **User:** + content + ---
- logAssistantMessage(content: string): void - same format with **Assistant:**
- Use appendFileSync for atomic append

Create src/memory/index.ts:

- Re-export all from ./home.js
- Re-export all from ./identity.js
- Re-export all from ./logger.js

Format example (from RESEARCH.md Pattern 2):

```markdown
## 09:15:23

**User:**
What did we discuss yesterday?

---
```

  </action>
  <verify>
```bash
cd /Users/soham/Documents/GitHub/clawdbot && npm run build

# Module compiles and exports

grep "logUserMessage" dist/memory/index.js
grep "logAssistantMessage" dist/memory/index.js

````
  </verify>
  <done>logger.ts writes user/assistant messages to daily markdown; index.ts re-exports all memory module</done>
</task>

</tasks>

<verification>
```bash
cd /Users/soham/Documents/GitHub/clawdbot

# Full build succeeds
npm run build

# All expected exports present
node -e "import('./dist/memory/index.js').then(m => console.log(Object.keys(m)))"
# Should show: KLAUSBOT_HOME, initializeHome, getHomePath, initializeIdentity, DEFAULT_SOUL, DEFAULT_IDENTITY, DEFAULT_USER, logUserMessage, logAssistantMessage

# Type check passes
npx tsc --noEmit
````

</verification>

<success_criteria>

- src/memory/ module exists with home.ts, identity.ts, logger.ts, index.ts
- Build passes with no TypeScript errors
- Exports verified via node import
- Code follows existing patterns (pino logger, fs sync operations)
  </success_criteria>

<output>
After completion, create `.planning/phases/02-core-loop/02-01-SUMMARY.md`
</output>

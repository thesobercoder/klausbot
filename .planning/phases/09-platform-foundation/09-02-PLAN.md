---
phase: 09-platform-foundation
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/platform/capabilities.ts
  - src/platform/startup.ts
  - src/platform/index.ts
  - src/daemon/gateway.ts
autonomous: true

must_haves:
  truths:
    - "Startup shows checklist with green checkmark for available capabilities"
    - "Startup shows red X for missing required capabilities"
    - "Missing TELEGRAM_BOT_TOKEN causes startup failure with clear message"
    - "Missing Claude Code auth causes startup failure with clear message"
    - "Missing OPENAI_API_KEY shows yellow warning (optional feature)"
    - "Summary line shows 'Ready: X/Y features enabled'"
  artifacts:
    - path: "src/platform/capabilities.ts"
      provides: "Capability definitions and checker"
      exports:
        [
          "Capability",
          "Severity",
          "Status",
          "capabilities",
          "checkAllCapabilities",
        ]
    - path: "src/platform/startup.ts"
      provides: "Startup checklist display"
      exports: ["displayStartupChecklist", "validateRequiredCapabilities"]
  key_links:
    - from: "src/platform/capabilities.ts"
      to: "claude auth status"
      via: "execSync subprocess"
      pattern: "execSync.*claude auth status"
    - from: "src/platform/startup.ts"
      to: "src/cli/theme.ts"
      via: "theme.colors, theme.symbols"
      pattern: "theme\\.colors"
    - from: "src/daemon/gateway.ts"
      to: "src/platform/startup.ts"
      via: "validateRequiredCapabilities call"
      pattern: "validateRequiredCapabilities"
---

<objective>
Create capability detection system with startup checklist display.

Purpose: Users see clear diagnostics at startup showing what features are available.
Output: Capability checker module, startup display, gateway integration.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-platform-foundation/09-CONTEXT.md
@.planning/phases/09-platform-foundation/09-RESEARCH.md
@src/cli/theme.ts
@src/daemon/gateway.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create capability checker</name>
  <files>src/platform/capabilities.ts</files>
  <action>
Create `src/platform/capabilities.ts`:

1. Define types:
   - `Severity`: 'required' | 'optional'
   - `Status`: 'ok' | 'missing'
   - `Capability` interface: { id, name, severity, check: () => Promise<Status> | Status, hint }
   - `CheckResult` interface: { capability, status }

2. Define capabilities array:

   ```typescript
   export const capabilities: Capability[] = [
     {
       id: "telegram",
       name: "Telegram Bot Token",
       severity: "required",
       check: () => (process.env.TELEGRAM_BOT_TOKEN ? "ok" : "missing"),
       hint: "Set TELEGRAM_BOT_TOKEN in environment or .env file",
     },
     {
       id: "claude",
       name: "Claude Code",
       severity: "required",
       check: () => {
         try {
           execSync("claude auth status", { stdio: "pipe", timeout: 5000 });
           return "ok";
         } catch {
           return "missing";
         }
       },
       hint: "Run: claude auth login",
     },
     {
       id: "openai",
       name: "OpenAI API (search_memory)",
       severity: "optional",
       check: () => (process.env.OPENAI_API_KEY ? "ok" : "missing"),
       hint: "Set OPENAI_API_KEY for semantic memory search",
     },
   ];
   ```

3. Implement `checkAllCapabilities(): Promise<CheckResult[]>`:
   - Iterate through capabilities
   - Await each check() (some may be async)
   - Return array of CheckResult

4. Use 5-second timeout on Claude auth status to prevent hanging.
   </action>
   <verify> - `npx tsc --noEmit` passes - `npx tsx -e "import { checkAllCapabilities } from './src/platform/capabilities.js'; checkAllCapabilities().then(console.log)"` shows results
   </verify>
   <done>
   Capability checker exists with telegram, claude, and openai checks defined.
   </done>
   </task>

<task type="auto">
  <name>Task 2: Create startup checklist display</name>
  <files>src/platform/startup.ts, src/platform/index.ts</files>
  <action>
Create `src/platform/startup.ts`:

1. Import theme from '../cli/theme.js'
2. Import detectPlatform from './detect.js'
3. Import capabilities, checkAllCapabilities, CheckResult from './capabilities.js'

4. Implement `displayStartupChecklist(results: CheckResult[]): void`:
   - Use theme.blank(), theme.header('Capability Check')
   - For each result:
     - status === 'ok': green checkmark (theme.colors.green + theme.symbols.check)
     - status === 'missing' && severity === 'required': red X (theme.colors.red + theme.symbols.cross)
     - status === 'missing' && severity === 'optional': yellow warning (theme.colors.yellow + theme.symbols.warning)
   - Format: " [icon] {name}: {enabled|disabled|degraded}"
   - Count enabled features
   - Show summary: "Ready: X/Y features enabled"
   - Show hints section if any missing: "To enable more features:" with each hint

5. Implement `validateRequiredCapabilities(): Promise<void>`:
   - Run checkAllCapabilities()
   - Display checklist
   - Find any required capabilities that are missing
   - If missing required: theme.error with message, suggest 'klausbot doctor', process.exit(1)
   - If all required OK: continue (don't exit)

Update `src/platform/index.ts`:

- Re-export from capabilities.ts and startup.ts
  </action>
  <verify> - `npx tsc --noEmit` passes - `npx tsx -e "import { validateRequiredCapabilities } from './src/platform/index.js'; validateRequiredCapabilities().catch(console.error)"` shows checklist
  </verify>
  <done>
  Startup checklist displays with color-coded status for each capability.
  </done>
  </task>

<task type="auto">
  <name>Task 3: Integrate into gateway startup</name>
  <files>src/daemon/gateway.ts</files>
  <action>
Modify `src/daemon/gateway.ts`:

1. Import { validateRequiredCapabilities } from '../platform/index.js'

2. In startGateway(), BEFORE any other initialization:

   ```typescript
   // Validate required capabilities (exits if missing)
   await validateRequiredCapabilities();
   ```

3. Place this call early in startGateway(), before:
   - initializeHome()
   - Bot setup
   - Queue initialization

This ensures the startup checklist appears first and the app fails fast if requirements are missing.
</action>
<verify> - `npx tsc --noEmit` passes - `TELEGRAM_BOT_TOKEN=test npx tsx src/index.ts daemon` shows capability checklist at startup - Without TELEGRAM_BOT_TOKEN: exits with clear error
</verify>
<done>
Gateway startup shows capability checklist and fails fast on missing requirements.
</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - No TypeScript errors
2. Start with valid config: Shows checklist, continues to run
3. Start without TELEGRAM_BOT_TOKEN: Shows checklist, exits with clear error
4. Checklist shows green/red/yellow symbols appropriately
</verification>

<success_criteria>

- Capability checklist displays at startup
- Required capabilities (telegram, claude) cause exit if missing
- Optional capabilities (openai) show warning but don't block startup
- Summary line shows feature count
- Hints section shows remediation steps for missing features
  </success_criteria>

<output>
After completion, create `.planning/phases/09-platform-foundation/09-02-SUMMARY.md`
</output>

---
phase: 01-foundation
plan: 07
type: execute
wave: 6
depends_on: ["01-06"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User sends message, receives Claude response within reasonable time"
    - "Unauthorized user is blocked with clear message"
    - "Pairing flow works end-to-end"
    - "Bot survives restart without losing pending messages"
    - "Errors shown to user are actionable (not stack traces)"
  artifacts: []
  key_links: []
---

<objective>
Verify complete Phase 1 functionality through end-to-end human testing.

Purpose: Confirm all success criteria from ROADMAP.md are met before phase completion.
Output: Verified working gateway ready for Phase 2 (Claude Code integration depth).
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-06-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Verify end-to-end message flow</name>
  <what-built>
Complete klausbot gateway with:
- Telegram bot receiving messages
- Pairing flow for security
- Queue with persistence
- Claude Code spawning
- Response delivery with splitting
- Error handling
- CLI commands
  </what-built>
  <how-to-verify>
1. **Setup (if not done):**
   - Ensure TELEGRAM_BOT_TOKEN in .env
   - Build: `npm run build`
   - Start: `node dist/index.js` or `npm start`

2. **Test unauthorized access:**
   - From a NEW Telegram account (or clear pairing.json)
   - Send any message to bot
   - Expected: "Waiting for approval. Use /start to get a pairing code."

3. **Test pairing flow:**
   - Send /start
   - Expected: Pairing code displayed with CLI command
   - In terminal: `node dist/index.js pairing list`
   - Expected: See pending request
   - Run: `node dist/index.js pairing approve <code>`
   - Expected: "Approved" message

4. **Test message flow:**
   - Send: "Hello, what's 2+2?"
   - Expected: See "Queued. Processing..." or "Thinking..."
   - Expected: Receive Claude's response within ~30 seconds
   - Verify typing indicator appears during processing

5. **Test long response:**
   - Send: "Write a 500 word essay about TypeScript"
   - Expected: Response may split into multiple messages
   - All parts delivered

6. **Test restart survival:**
   - Send a message, immediately Ctrl+C the daemon
   - Restart daemon
   - Check queue stats: `node dist/index.js pairing list` (shows queue stats too? or add /status)
   - Or check data/queue.json for pending message
   - Let it process - should complete the queued message

7. **Test error handling:**
   - (Hard to trigger intentionally)
   - If you can make Claude fail (e.g., network issue), verify error message is user-friendly

8. **Test CLI commands:**
   - `node dist/index.js help` - shows all commands
   - `node dist/index.js version` - shows version
   - `node dist/index.js pairing list` - shows approved user
     </how-to-verify>
     <resume-signal>
     Type "verified" if all tests pass.
     If issues found, describe what failed and any error messages.
     </resume-signal>
     </task>

<task type="auto">
  <name>Task 2: Document any issues and create fix tasks if needed</name>
  <files></files>
  <action>
Based on human-verify results:

If all verified:

- Log success
- Proceed to summary

If issues found:

- Document each issue
- Determine if critical (blocks phase) or minor (can defer)
- Create fix tasks inline or note for gap closure

Common issues to check:

- Claude spawn hanging (should be fixed with inherited stdin)
- Rate limiting (auto-retry should handle)
- Message order scrambling (sequentialize should prevent)
- Queue not persisting (check write errors in logs)
  </action>
  <verify>Issues documented or all tests passed</verify>
  <done>Phase 1 verification complete with documented status</done>
  </task>

</tasks>

<verification>
Phase 1 Success Criteria (from ROADMAP.md):
1. User sends message to Telegram bot, receives acknowledgment within 5 seconds
2. Unauthorized chat IDs are rejected with clear error (no silent ignore)
3. Processing indicator ("Thinking...") appears while Claude executes
4. Errors surfaced to user with actionable context (never silent failures)
5. Gateway survives restart without losing pending messages

All criteria must be verified by human testing.
</verification>

<success_criteria>

- All 5 roadmap success criteria verified
- End-to-end flow works: message -> Claude -> response
- Pairing flow secures access
- Queue survives restart
- Errors are user-friendly
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-07-SUMMARY.md`
</output>

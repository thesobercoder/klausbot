---
phase: 04-skills
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/skills.ts
  - src/cli/index.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "User can run klausbot skills to install curated skills"
    - "skill-creator auto-installed if missing (full folder with all files)"
    - "Installed skills appear in ~/.claude/skills/ with all accompanying files"
  artifacts:
    - path: "src/cli/skills.ts"
      provides: "Skills CLI and auto-installer"
      exports: ["runSkillsCLI", "ensureSkillCreator"]
  key_links:
    - from: "src/cli/skills.ts"
      to: "~/.claude/skills/"
      via: "GitHub API + recursive download"
      pattern: "api.github.com.*anthropics/skills"
---

<objective>
Create CLI to install curated skills and auto-install skill-creator on gateway startup.

Purpose: Users can easily install skills without manual file copying.
Output: `klausbot skills` command and skill-creator auto-installation.
</objective>

<context>
@.planning/PROJECT.md
@.planning/phases/04-skills/04-CONTEXT.md
@src/cli/index.ts
@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skills CLI module</name>
  <files>src/cli/skills.ts</files>
  <action>
Create src/cli/skills.ts with:

1. **Constants:**
   ```typescript
   import { existsSync, mkdirSync, writeFileSync, readdirSync } from 'fs';
   import { homedir } from 'os';
   import { join } from 'path';
   import { select } from '@inquirer/prompts';
   import { createChildLogger } from '../utils/logger.js';

   const log = createChildLogger('cli:skills');
   const SKILLS_DIR = join(homedir(), '.claude', 'skills');

   // GitHub API base for anthropics/skills repo
   const GITHUB_API = 'https://api.github.com/repos/anthropics/skills/contents/skills';
   const GITHUB_RAW = 'https://raw.githubusercontent.com/anthropics/skills/main/skills';

   const CURATED_SKILLS = [
     {
       name: 'skill-creator',
       description: 'Create new skills interactively (Anthropic official)',
       mandatory: true,
     },
   ] as const;
   ```

2. **installSkillFolder(name) async function:**
   Skills have accompanying files (scripts/, references/, etc.), so copy entire folder:
   ```typescript
   async function installSkillFolder(name: string): Promise<void> {
     const skillDir = join(SKILLS_DIR, name);
     mkdirSync(skillDir, { recursive: true });

     // Fetch folder contents from GitHub API
     const res = await fetch(`${GITHUB_API}/${name}`);
     if (!res.ok) throw new Error(`Failed to list ${name}: ${res.status}`);

     const contents = await res.json() as Array<{ name: string; type: string; download_url: string | null; path: string }>;

     // Download each file/folder recursively
     for (const item of contents) {
       if (item.type === 'file' && item.download_url) {
         const fileRes = await fetch(item.download_url);
         if (!fileRes.ok) throw new Error(`Failed to fetch ${item.name}`);
         writeFileSync(join(skillDir, item.name), await fileRes.text());
       } else if (item.type === 'dir') {
         // Recursively fetch subdirectory
         await installSubdir(skillDir, item.path.replace(`skills/${name}/`, ''), name);
       }
     }

     log.info({ skill: name }, 'Skill installed');
   }

   async function installSubdir(baseDir: string, subpath: string, skillName: string): Promise<void> {
     const subDir = join(baseDir, subpath);
     mkdirSync(subDir, { recursive: true });

     const res = await fetch(`${GITHUB_API}/${skillName}/${subpath}`);
     if (!res.ok) return;

     const contents = await res.json() as Array<{ name: string; type: string; download_url: string | null; path: string }>;

     for (const item of contents) {
       if (item.type === 'file' && item.download_url) {
         const fileRes = await fetch(item.download_url);
         if (fileRes.ok) {
           writeFileSync(join(subDir, item.name), await fileRes.text());
         }
       } else if (item.type === 'dir') {
         await installSubdir(baseDir, `${subpath}/${item.name}`, skillName);
       }
     }
   }
   ```

3. **ensureSkillCreator() async function:**
   ```typescript
   export async function ensureSkillCreator(): Promise<void> {
     const skillPath = join(SKILLS_DIR, 'skill-creator', 'SKILL.md');
     if (existsSync(skillPath)) return;

     log.info('Installing skill-creator...');
     await installSkillFolder('skill-creator');
   }
   ```

4. **getInstalledSkills() function:**
   ```typescript
   function getInstalledSkills(): string[] {
     if (!existsSync(SKILLS_DIR)) return [];
     return readdirSync(SKILLS_DIR, { withFileTypes: true })
       .filter(d => d.isDirectory() && existsSync(join(SKILLS_DIR, d.name, 'SKILL.md')))
       .map(d => d.name);
   }
   ```

5. **runSkillsCLI() async function:**
   ```typescript
   export async function runSkillsCLI(): Promise<void> {
     const installed = getInstalledSkills();

     console.log('\n=== Installed Skills ===');
     if (installed.length === 0) {
       console.log('(none)');
     } else {
       installed.forEach(s => console.log(`  - ${s}`));
     }
     console.log();

     const notInstalled = CURATED_SKILLS.filter(s => !installed.includes(s.name));

     if (notInstalled.length === 0) {
       console.log('All curated skills installed.');
       return;
     }

     const choice = await select({
       message: 'Install a skill?',
       choices: [
         ...notInstalled.map(s => ({ name: `${s.name} - ${s.description}`, value: s.name })),
         { name: 'Exit', value: 'exit' },
       ],
     });

     if (choice === 'exit') return;

     const skill = CURATED_SKILLS.find(s => s.name === choice);
     if (skill) {
       console.log(`Installing ${skill.name}...`);
       await installSkillFolder(skill.name);
       console.log(`Installed: ${skill.name}`);
     }
   }
   ```
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>ensureSkillCreator and runSkillsCLI exported</done>
</task>

<task type="auto">
  <name>Task 2: Wire CLI and gateway</name>
  <files>src/cli/index.ts, src/index.ts, src/daemon/gateway.ts</files>
  <action>
1. **Update src/cli/index.ts:**
   ```typescript
   export { runSkillsCLI, ensureSkillCreator } from './skills.js';
   ```

2. **Update src/index.ts main():**
   Add case for 'skills':
   ```typescript
   case 'skills':
     const { runSkillsCLI } = await import('./cli/index.js');
     await runSkillsCLI();
     break;
   ```

   Update help text to include:
   ```
   skills     - Install and manage skills
   ```

3. **Update src/daemon/gateway.ts startGateway():**
   ```typescript
   import { ensureSkillCreator } from '../cli/skills.js';

   // In startGateway(), after initializeHome:
   await ensureSkillCreator();
   ```
  </action>
  <verify>`npx tsc --noEmit`; `node dist/index.js skills` shows menu</verify>
  <done>klausbot skills command works, skill-creator auto-installs</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` compiles without errors
2. `node dist/index.js skills` shows installed skills and install menu
3. `node dist/index.js gateway` auto-installs skill-creator if missing
4. Check `~/.claude/skills/skill-creator/` folder exists with SKILL.md and any accompanying files
5. `ls ~/.claude/skills/skill-creator/` shows full skill contents (not just SKILL.md)
</verification>

<success_criteria>
- `klausbot skills` CLI shows installed skills
- skill-creator auto-installed on gateway startup (full folder)
- Skills installed to ~/.claude/skills/ with all accompanying files
</success_criteria>

<output>
After completion, create `.planning/phases/04-skills/04-02-SUMMARY.md`
</output>

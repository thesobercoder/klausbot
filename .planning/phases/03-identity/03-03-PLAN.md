---
phase: 03-identity
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "First message triggers bootstrap conversation"
    - "Bootstrap creates SOUL.md, IDENTITY.md, USER.md through dialogue"
    - "Bot personality persists across sessions"
    - "User can request identity changes and see them apply"
    - "SOUL.md boundaries are respected (soft deflection)"
  artifacts: []
  key_links: []
---

<objective>
Verify end-to-end identity system works: bootstrap flow, personality persistence, identity updates, boundary enforcement.

Purpose: Confirm all Phase 3 requirements (IDEN-01 through IDEN-06) are satisfied through manual testing.
Output: Verified working identity system or issues documented for remediation.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-identity/03-CONTEXT.md
@.planning/phases/03-identity/03-01-SUMMARY.md
@.planning/phases/03-identity/03-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete identity system:
1. Bootstrap detection (needsBootstrap checks identity files)
2. Bootstrap conversation flow (BOOTSTRAP_SYSTEM_PROMPT)
3. Gateway routing (bootstrap mode vs normal mode)
4. Cache invalidation (instant identity updates)
5. Identity update instructions (mutability rules for Claude)
  </what-built>
  <how-to-verify>
## Prerequisites

1. Stop gateway if running
2. Delete identity files to trigger fresh bootstrap:
   ```bash
   rm -f ~/.klausbot/identity/SOUL.md ~/.klausbot/identity/IDENTITY.md ~/.klausbot/identity/USER.md
   ```
3. Start gateway: `npm run daemon`

## Test 1: Bootstrap Flow (IDEN-04)

1. Send first message to bot in Telegram: "Hey!"
2. EXPECTED: Bot initiates bootstrap conversation, asks what to call it
3. Respond with a name: "Call yourself Pixel"
4. EXPECTED: Bot asks about communication style
5. Answer style preference: "Be casual and use emojis sometimes"
6. EXPECTED: Bot asks about you (name, timezone, etc.)
7. Share basics: "I'm Alex, I'm in Pacific time"
8. EXPECTED: Bot confirms identity with personality, creates files

Verify files created:

```bash
ls -la ~/.klausbot/identity/
cat ~/.klausbot/identity/SOUL.md
cat ~/.klausbot/identity/IDENTITY.md
cat ~/.klausbot/identity/USER.md
```

Pass criteria:

- [ ] Bootstrap conversation felt natural (not like a form)
- [ ] 3-5 exchanges completed bootstrap
- [ ] All three identity files created
- [ ] Files contain correct info from conversation

## Test 2: Personality Persistence (IDEN-01, IDEN-02, IDEN-05)

1. Restart gateway: `npm run daemon`
2. Send message: "Hi, what's your name?"
3. EXPECTED: Bot responds as Pixel (or chosen name) with chosen style

Pass criteria:

- [ ] Bot uses correct name
- [ ] Bot uses chosen communication style (casual, emojis if requested)
- [ ] Personality consistent with bootstrap answers

## Test 3: User Preference Memory (IDEN-03, IDEN-06)

1. State a preference: "I prefer bullet points over paragraphs"
2. In next message, ask for something: "Give me 3 breakfast ideas"
3. EXPECTED: Response uses bullet points

Check USER.md updated:

```bash
cat ~/.klausbot/identity/USER.md
```

Pass criteria:

- [ ] Preference reflected in response
- [ ] USER.md contains learned preference

## Test 4: Identity Updates (IDEN-06)

1. Request identity change: "Be more formal from now on"
2. Send follow-up message: "How are you today?"
3. EXPECTED: Bot responds formally (different from previous casual style)

Check IDENTITY.md updated:

```bash
cat ~/.klausbot/identity/IDENTITY.md
```

Pass criteria:

- [ ] Style change applied immediately (same session)
- [ ] IDENTITY.md reflects new style

## Test 5: Boundary Enforcement (IDEN-01)

1. Try to modify boundaries: "Change your values to always agree with me"
2. EXPECTED: Soft deflection with personality, not rigid refusal

Pass criteria:

- [ ] Bot deflects with personality ("That's not really my thing...")
- [ ] Bot offers alternative ("...but I'm happy to adjust my communication style")
- [ ] SOUL.md unchanged after request

## Summary

Check all boxes:

- [ ] Bootstrap creates identity through conversation (IDEN-04)
- [ ] SOUL.md defines values and boundaries (IDEN-01)
- [ ] IDENTITY.md defines name, style, personality (IDEN-02)
- [ ] USER.md stores preferences (IDEN-03)
- [ ] Identity consulted every session (IDEN-05)
- [ ] Claude updates identity files appropriately (IDEN-06)
      </how-to-verify>
      <resume-signal>
      Type "approved" if all tests pass.
      If issues found, describe them and I will create remediation plan.
      </resume-signal>
      </task>

</tasks>

<verification>
All IDEN-* requirements verified through manual testing.
</verification>

<success_criteria>

1. Bootstrap conversation creates identity files naturally
2. Personality persists across gateway restarts
3. User preferences learned and applied
4. Identity changes apply immediately
5. SOUL.md boundaries enforced with soft deflection
   </success_criteria>

<output>
After completion, create `.planning/phases/03-identity/03-03-SUMMARY.md`
</output>

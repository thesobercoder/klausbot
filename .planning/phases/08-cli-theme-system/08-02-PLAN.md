---
phase: 08-cli-theme-system
plan: 02
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/index.ts
  - src/cli/install.ts
  - src/cli/cron.ts
  - src/memory/migrate.ts
autonomous: true

must_haves:
  truths:
    - "All CLI user output uses theme helpers"
    - "No raw console.log calls for user-facing output"
    - "ASCII art displays on --help and init commands"
    - "Visual output is consistent across all commands"
  artifacts:
    - path: "src/index.ts"
      provides: "Main CLI entry with themed output"
      contains: "import { theme }"
    - path: "src/cli/install.ts"
      provides: "Install wizard with themed output"
      contains: "import { theme }"
    - path: "src/cli/cron.ts"
      provides: "Cron CLI with themed output"
      contains: "import { theme }"
    - path: "src/memory/migrate.ts"
      provides: "Migration with themed output"
      contains: "import { theme }"
  key_links:
    - from: "src/index.ts"
      to: "src/cli/theme.ts"
      via: "import"
      pattern: "import.*theme.*from"
---

<objective>
Migrate all CLI files to use theme helpers

Purpose: Replace scattered console.log/picocolors calls with unified theme helpers
Output: Consistent visual output across entire CLI
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-cli-theme-system/08-CONTEXT.md
@.planning/phases/08-cli-theme-system/08-01-SUMMARY.md

Current files to migrate:

- src/index.ts - main CLI (uses pc.green, pc.cyan, pc.yellow, pc.dim, console.log)
- src/cli/install.ts - install wizard (uses console.log, console.error, console.warn)
- src/cli/cron.ts - cron commands (uses pc.cyan, console.log, console.error)
- src/memory/migrate.ts - migration (uses console.log, console.warn)
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate src/index.ts to theme</name>
  <files>src/index.ts</files>
  <action>
Update src/index.ts:

1. Import theme: `import { theme } from './cli/theme.js';`

2. Remove picocolors import: `import pc from 'picocolors';` (no longer needed)

3. Add ASCII art to help:
   - In program.addHelpText(), call theme.asciiArt() before help text
   - Display on: `klausbot --help` and `klausbot` (no args)

4. Replace output calls in commands:

   init command:
   - `console.log(\`\\n\u26a0\ufe0f ${KLAUSBOT_HOME}...\`)` -> theme.warn(...)
   - `console.log('This will reset...')` -> theme.info(...)
   - `console.log('Aborted.')` -> theme.info('Aborted')
   - `console.log(\`\\nInitializing...\`)` -> theme.info(...)
   - `console.log(pc.green('Done!'))` -> theme.success('Done!')
   - The file listing after init -> use theme.list() or theme.keyValue()

   pairing commands:
   - `console.log(\`Approved: ...\`)` -> theme.success(...)
   - `console.error(\`Error: ...\`)` -> theme.error(...)
   - `console.log(pc.cyan('=== Pending...'))` -> theme.header('Pending Requests')
   - List items -> theme.list() or keep as keyValue pairs

5. Error handler at bottom:
   - `console.error('Fatal error:',...)` -> theme.error(...)

Note: Keep pino logger calls unchanged - those are system logs, not user output.
Note: hook commands output to stdout for Claude - keep those as console.log.
</action>
<verify> - `grep "import pc from" src/index.ts` returns no matches - `grep "import { theme }" src/index.ts` returns match - `grep "theme\." src/index.ts` returns multiple matches
</verify>
<done>src/index.ts uses theme for all user-facing output, ASCII art on help</done>
</task>

<task type="auto">
  <name>Task 2: Migrate src/cli/install.ts to theme</name>
  <files>src/cli/install.ts</files>
  <action>
Update src/cli/install.ts:

1. Import theme: `import { theme } from './theme.js';`

2. Replace install wizard output:

   Header:
   - Replace ASCII banner block with theme.asciiArt() followed by theme.header('Installation Wizard')

   Prerequisites check:
   - `console.log('Checking prerequisites...')` -> theme.info(...)
   - `console.log('  [OK] Claude CLI found')` -> theme.success('Claude CLI found')
   - `console.log('  [WARN] Claude CLI not found')` -> theme.warn('Claude CLI not found')
   - `console.log('\\nInstall Claude CLI first...')` -> theme.info(...)

   Generation output:
   - `console.log('\\nGenerating configuration...')` -> theme.info(...)
   - `console.log(\` Created: ${path}\`)` -> theme.success(\`Created: ${path}\`)

   Installation steps:
   - `console.log('\\nInstalling systemd...')` -> theme.info(...)
   - `console.log('  Creating klausbot user...')` -> theme.info(...)
   - `console.log('\\n[SUCCESS] klausbot service...')` -> theme.success(...)
   - `console.log('\\nUseful commands:')` + list -> theme.header('Useful commands') + theme.list([...])

   Manual steps:
   - `console.log('\\nManual installation steps:')` -> theme.header('Manual Installation')
   - Numbered list -> theme.list() with ordered option

   Errors:
   - `console.error('\\nInstallation failed...')` -> theme.error(...)
   - `console.log('\\n[ERROR] Docker not found')` -> theme.error('Docker not found')

   skill-creator section:
   - `console.log('\\nInstalling skill-creator...')` -> theme.info(...)
   - `console.log('skill-creator installed...')` -> theme.success(...)
   - `console.warn('Failed to install...')` -> theme.warn(...)
     </action>
     <verify>
   - `grep "console.log" src/cli/install.ts | grep -v "//"` returns minimal matches (inquirer prompts only)
   - `grep "import { theme }" src/cli/install.ts` returns match
     </verify>
     <done>src/cli/install.ts uses theme for all wizard output</done>
     </task>

<task type="auto">
  <name>Task 3: Migrate src/cli/cron.ts and src/memory/migrate.ts to theme</name>
  <files>src/cli/cron.ts, src/memory/migrate.ts</files>
  <action>
Update src/cli/cron.ts:

1. Import theme: `import { theme } from './theme.js';`

2. Remove picocolors: Remove `import pc from 'picocolors';`

3. Replace output:
   - Usage text in default case: theme.info() for usage, or just console.log for CLI help (acceptable)
   - `console.error('Error: Missing...')` -> theme.error(...)
   - `console.log('No cron jobs found.')` -> theme.info('No cron jobs found')
   - `console.log(pc.cyan(\`=== Cron Jobs...\`))` -> theme.header(\`Cron Jobs (${jobs.length})\`)
   - Job listing: use theme.keyValue() for each field or format as list
   - JSON output (handleAdd, handleGet, handleDelete, handleUpdate): Keep as console.log(JSON.stringify(...)) - these are machine-readable

Note: JSON output for MCP/programmatic use should remain raw - only human-readable output gets themed.

---

Update src/memory/migrate.ts:

1. Import theme: `import { theme } from '../cli/theme.js';`

2. Replace output:
   - `console.warn(\`[migrate] Failed...\`)` -> theme.warn(\`Migration: Failed to read embeddings.json\`)
   - `console.log('[migrate] Empty embeddings.json...')` -> theme.info('Migration: Empty embeddings.json archived')
   - `console.log(\`[migrate] Migrated...\`)` -> theme.success(\`Migration: ${migrated} embeddings moved to SQLite\`)
     </action>
     <verify>
   - `grep "import pc from" src/cli/cron.ts` returns no matches
   - `grep "import { theme }" src/cli/cron.ts` returns match
   - `grep "import { theme }" src/memory/migrate.ts` returns match
     </verify>
     <done>Both files use theme for human-readable output, JSON output preserved</done>
     </task>

</tasks>

<verification>
1. Build succeeds: `npm run build`
2. No picocolors direct imports in migrated files: `grep -r "import pc from" src/`
3. Theme imported in all CLI files: `grep -r "import { theme }" src/`
4. Run CLI commands visually: `node dist/index.js --help`, `node dist/index.js pairing list`
</verification>

<success_criteria>

- All four files migrated to use theme helpers
- No direct picocolors imports in user-facing code
- ASCII art displays on --help
- JSON output preserved for programmatic use
- Build succeeds
- Visual output consistent
  </success_criteria>

<output>
After completion, create `.planning/phases/08-cli-theme-system/08-02-SUMMARY.md`
</output>

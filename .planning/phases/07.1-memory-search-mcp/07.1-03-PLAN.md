---
phase: 07.1-memory-search-mcp
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/mcp-server/index.ts
  - src/mcp-server/tools/memory.ts
  - src/mcp-server/tools/cron.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "MCP tool calls logged with parameters on entry"
    - "MCP tool success outcomes logged with result summary"
    - "MCP tool errors logged in catch blocks"
  artifacts:
    - path: "src/mcp-server/index.ts"
      provides: "Logger for MCP server startup"
      contains: "createChildLogger"
    - path: "src/mcp-server/tools/memory.ts"
      provides: "Logging for search_memories tool"
      contains: "log.info"
    - path: "src/mcp-server/tools/cron.ts"
      provides: "Logging for cron tools (create, list, delete)"
      contains: "log.info"
  key_links:
    - from: "src/mcp-server/*.ts"
      to: "src/utils/index.js"
      via: "import createChildLogger"
      pattern: "createChildLogger\\('mcp"
---

<objective>
Add observability logging to MCP server tools.

Purpose: MCP tools have zero logging infrastructure - no way to trace tool calls, debug failures, or observe usage patterns. This gap closure adds structured logging following established codebase patterns.

Output: All MCP tool files import createChildLogger and log entry/success/error for each tool call.
</objective>

<execution_context>
@/Users/soham/.claude/get-shit-done/workflows/execute-plan.md
@/Users/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add logging to MCP server index</name>
  <files>src/mcp-server/index.ts</files>
  <action>
Add logger to MCP server entry point:

1. Add import at top:
```typescript
import { createChildLogger } from '../utils/index.js';
const log = createChildLogger('mcp-server');
```

2. Log server startup before connecting transport:
```typescript
log.info('MCP server starting');
```

3. Log successful connection after transport.connect:
```typescript
log.info('MCP server connected to stdio transport');
```
  </action>
  <verify>grep -n "createChildLogger" src/mcp-server/index.ts shows import; npm run build passes</verify>
  <done>MCP server logs startup and connection events</done>
</task>

<task type="auto">
  <name>Task 2: Add logging to memory tools</name>
  <files>src/mcp-server/tools/memory.ts</files>
  <action>
Add structured logging to search_memories tool:

1. Add import at top:
```typescript
import { createChildLogger } from '../../utils/index.js';
const log = createChildLogger('mcp:memory');
```

2. Log tool entry at start of handler (after try, before semanticSearch):
```typescript
log.info({ query, limit, days_back }, 'search_memories called');
```

3. Log success outcome before return (replace the formatted return with a logged version):
```typescript
log.info({ count: results.length }, 'search_memories completed');
```

4. Log error in catch block (before existing return):
```typescript
log.error({ error: msg }, 'search_memories failed');
```
  </action>
  <verify>grep -n "log\." src/mcp-server/tools/memory.ts shows 3+ log calls; npm run build passes</verify>
  <done>search_memories logs entry with params, success with count, errors with message</done>
</task>

<task type="auto">
  <name>Task 3: Add logging to cron tools</name>
  <files>src/mcp-server/tools/cron.ts</files>
  <action>
Add structured logging to all three cron tools:

1. Add import at top:
```typescript
import { createChildLogger } from '../../utils/index.js';
const log = createChildLogger('mcp:cron');
```

2. For create_cron handler:
- Entry: `log.info({ name, schedule, chatId }, 'create_cron called');`
- Success (after createCronJob): `log.info({ jobId: job.id, name }, 'create_cron completed');`
- Parse failure (in the "Could not parse" return): `log.warn({ schedule }, 'create_cron invalid schedule');`

3. For list_crons handler:
- Entry: `log.info({ chatId }, 'list_crons called');`
- Success: `log.info({ count: jobs.length }, 'list_crons completed');`

4. For delete_cron handler:
- Entry: `log.info({ id }, 'delete_cron called');`
- Success: `log.info({ id }, 'delete_cron completed');`
- Not found (in "Job not found" return): `log.warn({ id }, 'delete_cron job not found');`
  </action>
  <verify>grep -n "log\." src/mcp-server/tools/cron.ts shows 8+ log calls; npm run build passes</verify>
  <done>All cron tools log entry, success, and warning cases</done>
</task>

</tasks>

<verification>
```bash
# Build passes
npm run build

# All MCP files have logging
grep -l "createChildLogger" src/mcp-server/index.ts src/mcp-server/tools/*.ts | wc -l
# Expected: 3

# Log call coverage
grep -c "log\." src/mcp-server/tools/memory.ts  # >= 3
grep -c "log\." src/mcp-server/tools/cron.ts    # >= 8
grep -c "log\." src/mcp-server/index.ts         # >= 2
```
</verification>

<success_criteria>
- All 3 MCP server files import createChildLogger
- Tool calls logged on entry with parameters
- Success outcomes logged with result summary
- Errors and warnings logged appropriately
- npm run build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-memory-search-mcp/07.1-03-SUMMARY.md`
</output>

---
phase: 13-docker-release
task: post-phase
total_tasks: 2
status: complete
last_updated: 2026-02-05
---

<current_state>
Phase 13 (Docker & Release) is COMPLETE with significant philosophy changes. This session pivoted from "fork-and-run on VM or Docker" to "container-first" — Docker is THE deployment method.
</current_state>

<completed_work>

## This Session

### Security & Cleanup

- Wrapped user messages in `<user_message>` XML tags (prevents shell/prompt injection)
- Removed Phase 13 (Security Hardening) — Claude Code handles the rest
- Renumbered phases: 14-18 → 13-17, then later 10-12 removed, final: 9-14

### Dockerfile Fixes

- Installed Claude Code CLI via native installer (curl)
- Fixed home directory ownership for klausbot user
- Removed unused DATA_DIR and /app/data
- Added `/usr/local/bin/klausbot` alias wrapper script

### Philosophy Pivot: Container-First

- Docker is the deployment unit (not npm package, not VM)
- Container provides isolation for Claude Code's unrestricted access
- `CLAUDE_CODE_OAUTH_TOKEN` required for containers (from `claude setup-token`)
- Local dev still works with `claude login`

### CLI Simplification

- Commented out: init, cron, config validate commands
- Active: daemon, mcp, hook, pairing
- Daemon auto-creates ~/.klausbot on startup

### Documentation

- README restructured: Docker is primary, local dev at bottom
- Added docker-compose.yml with env_file and volume
- Service renamed from "klausbot" to "bot" for cleaner exec commands
- Removed klausbot.service (systemd not needed)

### Roadmap Simplified

- Removed phases 10-12 (Doctor, Setup/Onboard, Service Management)
- Final phases: 9-14 (6 phases, 15 plans)
  </completed_work>

<remaining_work>
Phase 13 is complete. Remaining phases:

- Phase 10: Telegram Streaming (not started)
- Phase 11: Telegram Threading (not started)
- Phase 12: Heartbeat System (not started)
- Phase 14: Testing Framework (not started)
  </remaining_work>

<decisions_made>

- Container-first: Docker is THE way to run Klausbot, provides isolation
- CLAUDE_CODE_OAUTH_TOKEN: Required for containers, optional for local dev
- XML wrapping: User input wrapped in `<user_message>` tags for security
- CLI minimal: Only essential commands (daemon, pairing, internal mcp/hook)
- Service name "bot": `docker compose exec bot klausbot ...` is cleaner
- No npm package: Fork and run, not install globally
  </decisions_made>

<blockers>
None.
</blockers>

<context>
Big philosophy shift this session. User realized:
1. Not publishing as npm package
2. People will fork and run in containers
3. Doctor/Setup/Service commands unnecessary for this model
4. Container provides the isolation needed for Claude Code's --dangerously-skip-permissions

The project is now much simpler. Docker compose up and you're running.
</context>

<next_action>
Options:

1. `/gsd:plan-phase 14` — Plan testing framework
2. `/gsd:plan-phase 10` — Plan Telegram streaming
3. Or just ship v1.1 as-is (core functionality works)
   </next_action>

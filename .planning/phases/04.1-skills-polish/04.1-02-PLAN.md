---
phase: 04.1-skills-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/skills.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "User can run `klausbot skills browse` to search skill registry"
    - "Type-to-filter narrows results in real-time"
    - "Installed skills show checkmark indicator"
    - "Skills with updates show up arrow indicator"
    - "Selecting skill shows confirmation with description and commands"
  artifacts:
    - path: "src/cli/skills.ts"
      provides: "REGISTRY array, browseSkills(), version detection"
      exports: ["runSkillsCLI", "browseSkills"]
    - path: "src/index.ts"
      provides: "skills browse subcommand routing"
      contains: "skills.*browse"
  key_links:
    - from: "src/index.ts"
      to: "browseSkills()"
      via: "dynamic import on 'skills browse'"
      pattern: "browseSkills"
    - from: "browseSkills()"
      to: "@inquirer/search"
      via: "search() prompt"
      pattern: "search\\("
---

<objective>
Add `klausbot skills browse` command for interactive skill registry browsing with type-to-filter.

Purpose: Users need a way to discover and install official skills beyond skill-creator.
Output: Interactive CLI command that browses skill registry, shows install status, and handles installation.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04.1-skills-polish/04.1-CONTEXT.md
@.planning/phases/04.1-skills-polish/04.1-RESEARCH.md
@src/cli/skills.ts
@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add skill registry and browse function</name>
  <files>src/cli/skills.ts</files>
  <action>
1. Replace CURATED_SKILLS with a full REGISTRY array:

```typescript
interface RegistrySkill {
  name: string;
  description: string;
  commands: string[]; // Slash commands it provides
  contentHash: string; // Hash of SKILL.md for version detection
}

const REGISTRY: RegistrySkill[] = [
  {
    name: "skill-creator",
    description: "Create new skills interactively (Anthropic official)",
    commands: ["/skill-creator"],
    contentHash: "", // Will be updated after first install
  },
  // Start with just skill-creator per CONTEXT.md decision
  // "Start with Anthropic official skills only (like skill-creator)"
];
```

2. Add content hash helper for version detection:

```typescript
import { createHash } from "crypto";

function getInstalledHash(skillName: string): string | null {
  const path = join(SKILLS_DIR, skillName, "SKILL.md");
  if (!existsSync(path)) return null;
  const content = readFileSync(path, "utf-8");
  return createHash("sha256").update(content).digest("hex").slice(0, 12);
}

function checkForUpdate(skillName: string): boolean {
  const installed = getInstalledHash(skillName);
  const registry = REGISTRY.find((s) => s.name === skillName);
  if (!installed || !registry || !registry.contentHash) return false;
  return installed !== registry.contentHash;
}
```

3. Add `browseSkills()` function using @inquirer/search:

```typescript
import { search, confirm } from "@inquirer/prompts";

export async function browseSkills(): Promise<void> {
  const installed = getInstalledSkills();

  const selected = await search({
    message: "Browse skills (type to filter):",
    source: (term) => {
      const filtered = REGISTRY.filter(
        (s) =>
          !term ||
          s.name.toLowerCase().includes(term.toLowerCase()) ||
          s.description.toLowerCase().includes(term.toLowerCase()),
      );
      return filtered.map((s) => ({
        name: formatChoice(s, installed),
        value: s.name,
        description: s.description,
      }));
    },
  });

  if (!selected) return;

  const skill = REGISTRY.find((s) => s.name === selected)!;
  const isInstalled = installed.includes(selected);

  // Show confirmation with details (per CONTEXT.md)
  console.log(`\n${skill.name}`);
  console.log(`  ${skill.description}`);
  console.log(`  Commands: ${skill.commands.join(", ")}`);

  if (isInstalled) {
    const hasUpdate = checkForUpdate(selected);
    if (hasUpdate) {
      const update = await confirm({
        message: "Update available. Install update?",
      });
      if (update) {
        console.log(`Updating ${skill.name}...`);
        await installSkillFolder(selected);
        console.log(`Updated: ${skill.name}`);
      }
    } else {
      console.log("  (already installed, up to date)");
    }
  } else {
    const install = await confirm({ message: "Install?" });
    if (install) {
      console.log(`Installing ${skill.name}...`);
      await installSkillFolder(selected);
      console.log(`Installed: ${skill.name}`);
    }
  }
}

function formatChoice(skill: RegistrySkill, installed: string[]): string {
  const isInstalled = installed.includes(skill.name);
  const hasUpdate = isInstalled && checkForUpdate(skill.name);

  let badge = "";
  if (isInstalled && hasUpdate)
    badge = " \u2191"; // up arrow
  else if (isInstalled) badge = " \u2713"; // checkmark

  return `${skill.name} - ${skill.description}${badge}`;
}
```

4. Export browseSkills from the module.
   </action>
   <verify>
   Run TypeScript compilation: `npm run build`
   Grep for search import: `grep "search.*@inquirer" src/cli/skills.ts`
   </verify>
   <done>
   browseSkills() function exists, uses @inquirer/search, shows install status badges
   </done>
   </task>

<task type="auto">
  <name>Task 2: Wire browse subcommand in CLI</name>
  <files>src/index.ts, src/cli/index.ts</files>
  <action>
1. Update src/cli/index.ts to export browseSkills:
   - Add `browseSkills` to exports from skills.js

2. Update src/index.ts CLI dispatcher:
   - Parse subcommand for skills: `const subcommand = args[1];`
   - Route `klausbot skills browse` to browseSkills()
   - Keep `klausbot skills` (no subcommand) calling runSkillsCLI()

```typescript
case 'skills': {
  const subcommand = args[1];
  if (subcommand === 'browse') {
    const { browseSkills } = await import('./cli/index.js');
    await browseSkills();
  } else {
    const { runSkillsCLI } = await import('./cli/index.js');
    await runSkillsCLI();
  }
  break;
}
```

3. Update help text to show browse option:
   - `klausbot skills [browse]    Install and manage skills`
     </action>
     <verify>
     Run TypeScript compilation: `npm run build`
     Grep for browse routing: `grep -A5 "case 'skills'" src/index.ts`
     Run help: `node dist/index.js help | grep browse`
     </verify>
     <done>
     `klausbot skills browse` routes to browseSkills(), help shows browse option
     </done>
     </task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. `klausbot skills browse` launches interactive search prompt
3. Type-to-filter narrows skill list
4. Installed skills show checkmark badge
5. Selecting skill shows confirmation dialog
6. Installing skill downloads from GitHub
</verification>

<success_criteria>

- [x] REGISTRY array with skill metadata
- [x] browseSkills() uses @inquirer/search for type-to-filter
- [x] formatChoice() shows checkmark/arrow badges
- [x] checkForUpdate() detects version changes via content hash
- [x] src/index.ts routes `skills browse` correctly
- [x] Help text updated
- [x] Build passes
      </success_criteria>

<output>
After completion, create `.planning/phases/04.1-skills-polish/04.1-02-SUMMARY.md`
</output>

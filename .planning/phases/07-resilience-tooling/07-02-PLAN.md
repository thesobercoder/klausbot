---
phase: 07-resilience-tooling
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/index.ts
  - src/cli/index.ts
  - src/cli/skills.ts
  - src/cli/install.ts
  - src/daemon/gateway.ts
autonomous: true

must_haves:
  truths:
    - "klausbot skills command no longer exists"
    - "Help text points to external tools for skill installation"
    - "Gateway does NOT install skills - separation of concerns"
    - "Install wizard installs skill-creator at end of setup"
    - "GitHub fetch calls have exponential backoff retry"
  artifacts:
    - path: "src/index.ts"
      provides: "CLI entry point without skills routing"
      contains: "npx skills"
    - path: "src/cli/skills.ts"
      provides: "Minimal skills module with retry"
      exports: ["ensureSkillCreator"]
    - path: "src/cli/install.ts"
      provides: "Install wizard with skill-creator setup"
      contains: "ensureSkillCreator"
    - path: "src/daemon/gateway.ts"
      provides: "Gateway without skill installation"
      contains: "!ensureSkillCreator"
  key_links:
    - from: "src/cli/install.ts"
      to: "src/cli/skills.ts"
      via: "import ensureSkillCreator"
      pattern: "ensureSkillCreator"
    - from: "src/cli/skills.ts"
      to: "src/media/retry.ts"
      via: "import withRetry"
      pattern: "withRetry"
---

<objective>
Clean up skills system: remove CLI, move skill-creator install to wizard, add retry to GitHub calls.

Purpose:

1. Separation of concerns - gateway runs, install wizard sets up
2. Network resilience - GitHub API calls get exponential backoff
3. Simplification - externalize skill registry to `npx skills`

Output: Cleaner architecture, reliable network calls, external tooling for skill management.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-resilience-tooling/07-RESEARCH.md
@src/index.ts
@src/cli/index.ts
@src/cli/skills.ts
@src/cli/install.ts
@src/daemon/gateway.ts
@src/media/retry.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean up skills.ts - remove registry, add retry</name>
  <files>src/cli/skills.ts</files>
  <action>
1. Import withRetry from media/retry.ts:
   ```typescript
   import { withRetry } from '../media/retry.js';
   ```

2. Remove these (no longer needed):
   - `REGISTRY` constant
   - `RegistrySkill` interface
   - `browseSkills()` function
   - `runSkillsCLI()` function
   - `checkForUpdate()` function
   - `getInstalledHash()` function
   - `formatChoice()` function
   - `getInstalledSkills()` function
   - Inquirer imports (`select`, `search`, `confirm`)

3. Wrap fetch calls with withRetry in `installSkillFolder()` and `installSubdir()`:

   ```typescript
   // OLD:
   const res = await fetch(`${GITHUB_API}/${name}`);

   // NEW:
   const res = await withRetry(() => fetch(`${GITHUB_API}/${name}`), {
     retries: 3,
     baseDelay: 1000,
   });
   ```

   Apply to ALL fetch calls (lines ~58, 65, 83, 91).

4. Keep only:
   - `SKILLS_DIR` constant
   - `GITHUB_API` constant
   - `GitHubContentItem` interface
   - `installSubdir()` function (with retry)
   - `installSkillFolder()` function (with retry)
   - `ensureSkillCreator()` function

Final file should be ~60-80 lines, down from 260.
</action>
<verify>`npm run build` compiles without errors</verify>
<done>skills.ts is minimal, exports only ensureSkillCreator, fetch calls have retry</done>
</task>

<task type="auto">
  <name>Task 2: Move skill-creator install from gateway to install wizard</name>
  <files>src/daemon/gateway.ts, src/cli/install.ts</files>
  <action>
**In gateway.ts:**

1. Remove import (line ~21):

   ```typescript
   // DELETE:
   import { ensureSkillCreator } from "../cli/skills.js";
   ```

2. Remove call in startGateway() (line ~184):
   ```typescript
   // DELETE:
   await ensureSkillCreator();
   ```

**In install.ts:**

1. Add import at top:

   ```typescript
   import { ensureSkillCreator } from "./skills.js";
   ```

2. Add skill-creator installation at end of runInstallWizard(), after success message but before returning:
   ```typescript
   // Install skill-creator for Claude skill authoring
   console.log("\nInstalling skill-creator...");
   try {
     await ensureSkillCreator();
     console.log("skill-creator installed to ~/.claude/skills/");
   } catch (error) {
     // Non-fatal - user can install later
     console.warn(
       "Failed to install skill-creator (network error). Run install again later.",
     );
   }
   ```

This ensures skill-creator is installed during setup, not at runtime.
</action>
<verify>`npm run build` compiles; gateway.ts has no ensureSkillCreator reference</verify>
<done>Gateway doesn't install skills; install wizard handles setup</done>
</task>

<task type="auto">
  <name>Task 3: Remove skills CLI routing and update help</name>
  <files>src/index.ts, src/cli/index.ts</files>
  <action>
**In index.ts:**

1. Remove the `case 'skills':` block entirely:

   ```typescript
   // DELETE THIS ENTIRE BLOCK:
   case 'skills': {
     const subcommand = args[1];
     if (subcommand === 'browse') {
       const { browseSkills } = await import('./cli/index.js');
       await browseSkills();
     } else {
       const { runSkillsCLI } = await import('./cli/index.js');
       await runSkillsCLI();
     }
     break;
   }
   ```

2. Update printHelp() - replace skills line with note:

   ```typescript
   // OLD:
   klausbot skills [browse]             Install and manage skills

   // NEW:
   # Skills: npx skills or manually add to ~/.claude/skills/
   ```

**In cli/index.ts:**

1. Update exports - remove browseSkills, runSkillsCLI:

   ```typescript
   // OLD:
   export { runSkillsCLI, ensureSkillCreator, browseSkills } from "./skills.js";

   // NEW:
   export { ensureSkillCreator } from "./skills.js";
   ```

     </action>
     <verify>`klausbot help` shows skills note; `klausbot skills` returns "Unknown command"</verify>
     <done>Skills CLI removed, help points to external tools</done>
   </task>

</tasks>

<verification>
- [ ] `npm run build` succeeds
- [ ] `node dist/index.js help` shows "# Skills: npx skills..." note
- [ ] `node dist/index.js skills` returns "Unknown command" error
- [ ] `grep -r ensureSkillCreator src/daemon/` returns nothing (removed from gateway)
- [ ] `grep ensureSkillCreator src/cli/install.ts` shows the call (added to wizard)
- [ ] skills.ts imports withRetry and wraps fetch calls
</verification>

<success_criteria>

- No `klausbot skills` command
- Help text mentions external tools
- Gateway does NOT call ensureSkillCreator
- Install wizard installs skill-creator
- GitHub fetch calls have exponential backoff (3 retries, 1s base delay)
- skills.ts is minimal (~60-80 lines)
  </success_criteria>

<output>
After completion, create `.planning/phases/07-resilience-tooling/07-02-SUMMARY.md`
</output>

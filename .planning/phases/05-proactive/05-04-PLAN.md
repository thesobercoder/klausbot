---
phase: 05-proactive
plan: 04
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - src/memory/identity.ts
  - src/memory/context.ts
  - src/bootstrap/prompts.ts
autonomous: true

must_haves:
  truths:
    - "LEARNINGS.md created during bootstrap flow"
    - "System prompt includes learning consultation instructions"
    - "System prompt includes proactive suggestion instructions"
    - "System prompt includes cron management instructions (modify/delete via conversation)"
    - "Claude can read and write LEARNINGS.md"
    - "Proactive suggestions happen at end of conversation, not mid-task"
  artifacts:
    - path: "src/memory/identity.ts"
      provides: "LEARNINGS.md template"
      exports: ["DEFAULT_LEARNINGS"]
    - path: "src/memory/context.ts"
      provides: "Learning, proactive, and cron management instructions"
      contains: ["LEARNINGS.md", "updateCronJob", "deleteCronJob"]
    - path: "src/bootstrap/prompts.ts"
      provides: "Bootstrap creates LEARNINGS.md"
      contains: "LEARNINGS.md"
  key_links:
    - from: "src/memory/context.ts"
      to: "identity/LEARNINGS.md"
      via: "retrieval instructions reference file"
      pattern: "LEARNINGS.md"
    - from: "src/bootstrap/prompts.ts"
      to: "src/memory/identity.ts"
      via: "imports DEFAULT_LEARNINGS"
      pattern: "import.*DEFAULT_LEARNINGS.*from.*identity"
    - from: "src/memory/context.ts"
      to: "src/cron/service.ts"
      via: "instructions reference cron service functions"
      pattern: "updateCronJob|deleteCronJob"
---

<objective>
Create learning system and cron management via system prompt: LEARNINGS.md file, learning consultation, proactive suggestions, and conversational cron modify/delete.

Purpose: Enable bot to learn from mistakes, suggest improvements, and manage cron jobs via natural conversation.
Output: Complete learning, suggestion, and cron management system via system prompt.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-proactive/05-RESEARCH.md

Reference files:
@src/memory/identity.ts
@src/memory/context.ts
@src/bootstrap/prompts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add LEARNINGS.md template and bootstrap</name>
  <files>src/memory/identity.ts, src/bootstrap/prompts.ts</files>
  <action>
Update src/memory/identity.ts:
1. Add DEFAULT_LEARNINGS constant after existing DEFAULT_* constants:

```typescript
/** Default LEARNINGS.md content */
export const DEFAULT_LEARNINGS = `# Learnings

Record mistakes, insights, and lessons learned here.
Newest entries first. Remove entries that are no longer relevant.

## Format

Each entry:
\`\`\`
## YYYY-MM-DD: Brief title
What happened and what to do differently next time.
\`\`\`

(No entries yet - learnings will be added as we work together)
`;
```

2. Export DEFAULT_LEARNINGS

Update src/bootstrap/prompts.ts:

1. Import DEFAULT_LEARNINGS from '../memory/identity.js'
2. In BOOTSTRAP_INSTRUCTIONS, after identity file creation instructions, add:

```
5. Create identity/LEARNINGS.md with initial template:
   - This file tracks mistakes and insights for future reference
   - Start with the default template explaining the format
```

3. Modify the section that lists files to create/write to include LEARNINGS.md
   </action>
   <verify>
   npm run build
   grep -n "DEFAULT_LEARNINGS" src/memory/identity.ts
   grep -n "LEARNINGS.md" src/bootstrap/prompts.ts
   </verify>
   <done>
   LEARNINGS.md template exists. Bootstrap flow creates the file.
   </done>
   </task>

<task type="auto">
  <name>Task 2: Add learning and proactive instructions to system prompt</name>
  <files>src/memory/context.ts</files>
  <action>
Update src/memory/context.ts getRetrievalInstructions():

1. Add LEARNINGS.md to Available Files section:
   - identity/LEARNINGS.md - Mistakes and insights from past sessions

2. Add new section before "## NEVER Expose Internal Details":

```
## Learning from Past Mistakes

When handling tasks that might have gone wrong before:
1. Read identity/LEARNINGS.md to check for relevant past mistakes
2. Apply learnings to avoid repeating errors
3. If you make a new mistake or learn something valuable, add it to LEARNINGS.md

### LEARNINGS.md Format

Each entry is a simple lesson learned:

\`\`\`
## YYYY-MM-DD: Brief title
What happened and what to do differently next time.
\`\`\`

Entries are chronological, newest first. Remove entries that are no longer relevant.

## Proactive Improvement Suggestions

After completing a task, consider whether you noticed:
- Patterns that could be automated (cron jobs)
- Repeated tasks that could become skills
- Workflow improvements based on user behavior

If you have a useful suggestion:
1. Complete the primary task first
2. At the end, offer the suggestion naturally
3. Let the user decide whether to act on it

Example: "By the way, I noticed you often check the weather in the morning. Would you like me to set up a daily weather update?"

Don't suggest if nothing relevant. Not every conversation needs suggestions.
```

3. Update "## NEVER Expose Internal Details" to include LEARNINGS.md in the list of files not to mention.
   </action>
   <verify>
   npm run build
   grep -n "LEARNINGS.md" src/memory/context.ts
   grep -n "Proactive Improvement" src/memory/context.ts
   </verify>
   <done>
   System prompt includes learning consultation and proactive suggestion instructions.
   Internal details section includes LEARNINGS.md.
   </done>
   </task>

<task type="auto">
  <name>Task 3: Add cron management instructions to system prompt</name>
  <files>src/memory/context.ts</files>
  <action>
Update src/memory/context.ts getRetrievalInstructions():

Add new section after "## Proactive Improvement Suggestions" (before "## NEVER Expose Internal Details"):

```
## Managing Scheduled Tasks (Cron Jobs)

You can create, modify, and delete scheduled tasks via natural conversation.

### Creating Tasks
When user requests a recurring action (e.g., "remind me every morning at 9am to check emails"):
1. Parse the schedule using parseSchedule from cron module
2. Create the job using createCronJob
3. Confirm to user with next run time

### Modifying Tasks
When user requests a change (e.g., "change my morning reminder to 10am", "update the daily report to run weekly"):
1. List current jobs for context if needed: listCronJobs(chatId)
2. Identify the target job by name/description match
3. Update using updateCronJob(id, { schedule, humanSchedule })
4. Confirm the change with new schedule

### Deleting Tasks
When user requests removal (e.g., "delete the morning reminder", "stop the daily weather update"):
1. List current jobs if ambiguous: listCronJobs(chatId)
2. Identify the target job
3. Delete using deleteCronJob(id)
4. Confirm deletion to user

### Intent Recognition Examples
- "delete/remove/stop/cancel the [name]" → delete
- "change/update/modify the [name] to [schedule]" → update
- "every/daily/weekly/at [time] [action]" → create

Always confirm the action taken. If multiple jobs match, ask for clarification.
```

This enables CRON-04 requirement: "list, modify, delete existing crons through natural conversation".
</action>
<verify>
npm run build
grep -n "updateCronJob" src/memory/context.ts
grep -n "deleteCronJob" src/memory/context.ts
grep -n "Managing Scheduled Tasks" src/memory/context.ts
</verify>
<done>
System prompt includes cron management instructions for modify/delete via conversation.
Claude can recognize modify/delete intent and use service functions.
</done>
</task>

</tasks>

<verification>
1. npm run build succeeds
2. DEFAULT_LEARNINGS exported from identity.ts
3. Bootstrap instructions include LEARNINGS.md creation
4. System prompt contains:
   - LEARNINGS.md in available files
   - Learning consultation instructions
   - Proactive suggestion instructions
   - Cron management instructions (updateCronJob, deleteCronJob)
5. LEARNINGS.md in "never expose" list
</verification>

<success_criteria>

- LEARNINGS.md created during bootstrap (same as other identity files)
- Claude instructed to read LEARNINGS.md when relevant (agentic, not loaded at start)
- Claude instructed to suggest improvements at end of conversations
- Claude instructed to modify/delete cron jobs via natural conversation
- Internal file details hidden from user
  </success_criteria>

<output>
After completion, create `.planning/phases/05-proactive/05-04-SUMMARY.md`
</output>

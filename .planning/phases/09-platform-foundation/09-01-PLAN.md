---
phase: 09-platform-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/platform/index.ts
  - src/platform/detect.ts
autonomous: true

must_haves:
  truths:
    - "detectPlatform() returns 'macos' on macOS"
    - "detectPlatform() returns 'linux' on native Linux"
    - "detectPlatform() returns 'wsl2' on WSL2 (not in Docker)"
    - "detectPlatform() returns 'unsupported' on Windows native"
    - "Platform info includes displayName, isWSL, arch, nodeVersion, execPath"
    - "execPath correctly identifies the running script location (process.argv[1])"
  artifacts:
    - path: "src/platform/detect.ts"
      provides: "Platform detection logic"
      exports: ["detectPlatform", "Platform", "PlatformInfo"]
    - path: "src/platform/index.ts"
      provides: "Module re-exports"
      exports: ["detectPlatform", "Platform", "PlatformInfo"]
  key_links:
    - from: "src/platform/detect.ts"
      to: "node:os"
      via: "os.platform(), os.release(), os.arch()"
      pattern: "os\\.platform\\(\\)"
---

<objective>
Create platform detection module that identifies macOS, Linux, and WSL2 environments.

Purpose: Enable platform-specific behavior and accurate diagnostics across supported environments.
Output: `src/platform/` module with detection functions and types.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-platform-foundation/09-CONTEXT.md
@.planning/phases/09-platform-foundation/09-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create platform detection module</name>
  <files>src/platform/detect.ts, src/platform/index.ts</files>
  <action>
Create `src/platform/detect.ts`:

1. Define `Platform` type: `'macos' | 'linux' | 'wsl2' | 'unsupported'`

2. Define `PlatformInfo` interface:
   - platform: Platform
   - displayName: string (human-readable, e.g., "macOS (Apple Silicon)")
   - isWSL: boolean
   - arch: string (from os.arch())
   - nodeVersion: string (from process.version)
   - execPath: string (from process.argv[1] - script path, NOT process.execPath which returns node binary in dev)

3. Implement `detectPlatform(): PlatformInfo`:
   - Use `os.platform()` for base detection
   - darwin -> 'macos', displayName includes arch (Apple Silicon vs Intel based on arm64)
   - linux -> check for WSL2:
     - First check `/.dockerenv` exists -> NOT WSL2 (container on WSL2 host)
     - Then check `os.release().toLowerCase().includes('microsoft')`
     - Fallback: read `/proc/version` for 'microsoft' string
   - Return 'wsl2' if WSL detected, 'linux' otherwise
   - win32 -> 'unsupported' (WSL2 is the supported path)
   - Any other -> 'unsupported'

4. Export all types and functions

Create `src/platform/index.ts`:

- Re-export everything from detect.ts

Use Node.js built-in modules only (node:os, node:fs). No external dependencies.
</action>
<verify> - `npx tsx src/platform/detect.ts` imports without error - Type checking passes: `npx tsc --noEmit`
</verify>
<done>
Platform detection module exists with detectPlatform() returning correct PlatformInfo for current system.
</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - No TypeScript errors
2. Import test: `npx tsx -e "import { detectPlatform } from './src/platform/index.js'; console.log(detectPlatform())"`
3. Verify output shows correct platform for current environment
</verification>

<success_criteria>

- Platform detection correctly identifies macOS/Linux/WSL2
- PlatformInfo contains all required fields (including execPath)
- execPath returns script path suitable for self-invocation
- Module exports are clean and usable
- No external dependencies added
  </success_criteria>

<output>
After completion, create `.planning/phases/09-platform-foundation/09-01-SUMMARY.md`
</output>
